# 在U盘启动

需要一个可以**格式化**的U盘，可以通过`lsblk`查看挂载的设备。

格式化U盘命令：

```
sudo fdisk /dev/sdb
```

然后按照提示，可以用d来删除分区，再用n设置**一个分区**。

## 在U盘上设置MBR

```bash 
sudo dd if=/dev/sdb of=tmp.bin bs=512 count=1 conv=notrunc ;将U盘第一个扇区读到tmp.bin
cp tmp.bin usb.bin ;拷贝到usb.bin便于直接读取
sudo rm tmp.bin ;删除旧的
dd if=boot.bin of=usb.bin bs=446 count=1 conv=notrunc ;将我们写的boot.bin写到usb.bin中
sudo dd if=usb.bin of=/dev/sdb bs=512 count=1 conv=notrunc ;将usb.bin写回到U盘中
rm usb.bin ;删除usb.bin
```

注意写入自己写的boot.bin到U盘第一个分区时只能写446个字节，千万不能覆盖之后的64个字节的**分区表**(还有最后两个魔数55AA😄)


U盘设置好MBR之后，就可以作为一个物理盘在VirtualBox上跑了。

事实上用bximage生产的虚拟硬盘`master.img`，这个本质上是个**文件**，但是我们可以用`qemu`的一些命令把这个文件转换成VirtualBox或者VMware支持的**硬盘格式**，这样也可以作为物理盘在VirtualBox跑了。

## qemu的转换命令

```
qemu-img convert -O vmdk master.img master.vmdk ;输出成VMware支持的vmdk格式
qemu-img convert -O vdi master.img master.vdi ;输出成VirtualBox支持的vdi格式
```

当然实际上最新的VirtualBox或者VMware都支持多种格式的虚拟磁盘了，vdi和vmdk都支持🤭


我们这节直接用的**真**U盘，当然不必考虑什么虚拟的玩意了，这里算是个小的拓展。