# ä¸»å¼•å¯¼æ‰‡åŒº

ç¼–å†™makefileæ–¹ä¾¿ä½¿ç”¨:
```makefile
%.bin: %.asm
	nasm $< -o $@

master.img: boot.bin
	yes | bximage -hd -mode="flat" -size=16 -q master.img
	dd if=$< of=$@ bs=512 count=1 conv=notrunc

.PHONY: bochs
bochs:master.img
	bochs -q

.PHONY:clean
clean:
	rm -rf master.img
	rm -rf *.bin%      
```

## BIOS
Basic Input Output System

BIOSåŠ ç”µåè‡ªæ£€å¹¶å°†ä¸»å¼•å¯¼æ‰‡åŒºåŠ è½½åˆ°0x7c00çš„ä½ç½®ï¼Œå¹¶**è·³è½¬**åˆ°è¿™é‡Œæ‰§è¡Œã€‚
```
int 0x10; BOISçš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¾ç¤ºå™¨ç›¸å…³åŠŸèƒ½
```
å½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨BIOSæä¾›çš„åŠŸèƒ½æ¸…ç©ºå±å¹•ï¼Œä½†æ˜¯è¿™æ ·å¾ˆç®€å•ã€‚

## å®æ¨¡å¼
8086æ˜¯16ä½çš„ï¼Œå®æ¨¡å¼å¯»å€ï¼š
```
mov ax, 0xb800
mov ds, ax
```

æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸçš„å†…å­˜æ˜¯0xb8000ï¼Œä½†æ˜¯æˆ‘ä»¬æ”¾åˆ°dsä¸­çš„æ˜¯0xb800ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

è¿™æ˜¯å› ä¸º8086é¸¡è‚‹çš„å¯»å€æ–¹å¼ï¼ŒCPU 16ä½çš„ä½å®½æƒ³è¦è®¿é—®1Mçš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯20ä½ã€‚å¼•å…¥äº†æ®µå¯„å­˜å™¨(åŒæ ·16bit)ï¼Œå¯»å€æ—¶å°†æ®µå¯„å­˜å™¨çš„å€¼å·¦ç§»4ä½ï¼Œå†åŠ ä¸Šåç§»åœ°å€(æ‰€è°“çš„æ®µå†…åç§»)ã€‚
> æœ‰æ•ˆåœ°å€ = æ®µåœ°å€ << 4 + åç§»åœ°å€


å› ä¸º<<4ä½ä½¿å¾—å¯ä»¥è®¿é—®åˆ°1Mçš„å†…å­˜ï¼Œä½†æ˜¯æœ‰å¯èƒ½è¶…å‡º20ä½ï¼Œäºæ˜¯åˆå¢åŠ äº†**åœ°å€å›ç»•æœºåˆ¶**ã€‚

è¿™å°±æ˜¯A20æ€»çº¿çš„ç”±æ¥ï¼Œä¹‹åçš„80286å†…å­˜æ›´å¤§å·²ç»ä¸éœ€è¦åœ°å€å›ç»•äº†ï¼Œä½†æ˜¯ä¸ºäº†**åå‘å…¼å®¹**ï¼Œä¸å¾—ä¸å…ˆå›ç»•ï¼Œç„¶åå†å¼€å¯A20æ€»çº¿ï¼Œä½¿è¶…å‡º1Mçš„åœ°å€ä¸å†å›ç»•ï¼Œè¿‡ä¸Šäº†å®½è£•çš„æ—¥å­ğŸ¤­

å¼€å¯ä¿æŠ¤æ¨¡å¼ä¹‹åï¼Œæ®µå¯„å­˜å™¨é‡Œå°±ä¸å†æ”¾æ®µåŸºå€è¿™ç§å¤æ—©çš„æ–¹å¼äº†ï¼Œè€Œæ˜¯å˜æˆäº†GDTçš„ç´¢å¼•ï¼Œæœ‰äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œä¹‹åå†è¯´ã€‚

## ä¸»å¼•å¯¼æ‰‡åŒºçš„ç»“æ„
æ€»å…±**ä¸€ä¸ªæ‰‡åŒº**ï¼Œ512ä¸ªå­—èŠ‚

- ä»£ç ï¼š446B
- ç¡¬ç›˜åˆ†åŒºè¡¨ï¼š64B = 4*16B
- é­”æ•°ï¼šå…¸ä¸­å…¸çš„æœ€åçš„55AAä¸¤ä¸ªå­—èŠ‚

### ä¸»è¦åŠŸèƒ½
- è¯»å–**å†…æ ¸åŠ è½½å™¨**loaderå¹¶**è·³è½¬æ‰§è¡Œ**ã€‚

